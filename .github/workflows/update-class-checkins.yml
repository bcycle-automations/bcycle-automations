name: Update class check-ins from MTEK

on:
  schedule:
    # Runs 10:00 UTC = 5:00 AM EST
    - cron: "0 10 * * *"
  workflow_dispatch: {} # allow manual run

jobs:
  update-checkins:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: "22"

      # No dependencies required â€” script uses built-in Node fetch
      - name: Install dependencies
        run: echo "No dependencies required"

      - name: Run update script
        run: node scripts/update-class-checkins.js
        env:
          # --- Secrets ---
          AIRTABLE_TOKEN: ${{ secrets.AIRTABLE_TOKEN }}
          AIRTABLE_BASE_ID: ${{ secrets.INSTRUCTOR_SUBS_BASE_ID }}
          MTEK_API_TOKEN: ${{ secrets.MTEK_API_TOKEN }}

          # --- NOT secrets ---
          AIRTABLE_ALL_CLASSES_TABLE: "All Classes"
          AIRTABLE_VIEW_TO_UPDATE: "TO UPDATE DO NOT TOUCH"
          AIRTABLE_FIELD_CLASS_SESSION_ID: "Class Session ID"
          AIRTABLE_FIELD_COUNT: "Count"
